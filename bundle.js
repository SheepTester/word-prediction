!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){!function(){var e=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],n="undefined"!=typeof window,i=n&&null!=window.mozInnerScreenX;function o(t,o,s){if(!n)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var r=s&&s.debug||!1;if(r){var l=document.querySelector("#input-textarea-caret-position-mirror-div");l&&l.parentNode.removeChild(l)}var a=document.createElement("div");a.id="input-textarea-caret-position-mirror-div",document.body.appendChild(a);var c=a.style,d=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,h="INPUT"===t.nodeName;c.whiteSpace="pre-wrap",h||(c.wordWrap="break-word"),c.position="absolute",r||(c.visibility="hidden"),e.forEach((function(t){h&&"lineHeight"===t?c.lineHeight=d.height:c[t]=d[t]})),i?t.scrollHeight>parseInt(d.height)&&(c.overflowY="scroll"):c.overflow="hidden",a.textContent=t.value.substring(0,o),h&&(a.textContent=a.textContent.replace(/\s/g," "));var u=document.createElement("span");u.textContent=t.value.substring(o)||".",a.appendChild(u);var f={top:u.offsetTop+parseInt(d.borderTopWidth),left:u.offsetLeft+parseInt(d.borderLeftWidth),height:parseInt(d.lineHeight)};return r?u.style.backgroundColor="#aaa":document.body.removeChild(a),f}void 0!==t.exports?t.exports=o:n&&(window.getCaretCoordinates=o)}()},function(t,e,n){"use strict";n.r(e);var i=n(0);const o="[",s="⎡",r="⎢",l="⎣",a="]",c="⎤",d="⎥",h="⎦";class u{constructor(t,e,n){if(this.rows=t,this.cols=e,this._length=t*e,n&&n.length!==this._length)throw new Error("Given matrix does not match the given dimensions.");this.data=new Float32Array(n||this._length)}scale(t){for(let e=0;e<this._length;e++)this.data[e]*=t;return this}multiply(t){if(this.cols!==t.rows)throw new Error(`Cannot multiply matrices of dimensions ${this.rows} x ${this.cols} and ${t.rows} x ${t.cols}`);const e=this.cols,n=new u(this.rows,t.cols);for(let i=0;i<this.rows;i++)for(let o=0;o<t.cols;o++){const s=i*n.cols+o;for(let r=0;r<e;r++)n.data[s]+=this.data[i*this.cols+r]*t.data[r*t.cols+o]}return n}transpose(){const t=new u(this.cols,this.rows);for(let e=0;e<this.rows;e++)for(let n=0;n<this.cols;n++)t.data[n*t.cols+e]=this.data[e*this.cols+n];return t}rowSums(){const t=new Float32Array(this.rows);for(let e=0;e<this.rows;e++){let n=0;for(let t=0;t<this.cols;t++)n+=this.data[e*this.cols+t];t[e]=n}return t}get(t,e){return this.data[t*this.cols+e]}set(t,e,n){return this.data[t*this.cols+e]=n,this}clone(){return new u(this.rows,this.cols,this.data)}toString(){let t="\n";for(let e=0;e<this.rows;e++)t+=0===e?1===this.rows?o:s:e===this.rows-1?l:r,t+=" "+this.data.slice(e*this.cols,(e+1)*this.cols).join("\t")+" ",t+=0===e?1===this.rows?a:c:e===this.rows-1?h:d,t+="\n";return t}toFile(){let t=`${this.rows}x${this.cols}`,e=null,n=0;for(const i of this.data)i===e?n++:(n>0&&(t+=1===n?`\n${e}`:`\n${e}x${n}`),e=i,n=1);return n>0&&(t+=1===n?`\n${e}`:`\n${e}x${n}`),t}hasNaN(){for(const t of this.data)if(Number.isNaN(t))return!0;return!1}static identity(t){const e=new this(t,t);for(let n=0;n<t;n++)e.data[n*t+n]=1;return e}static fromFile(t){const[e,...n]=t.split(/\r?\n/).filter(t=>t),[,i,o]=e.match(/(\d+)x(\d+)/),s=new u(+i,+o);let r=0;for(const t of n){const[,e,n]=t.match(/(\d+)(?:x(\d+))?/),i=+e,o=n?+n:1;for(let t=0;t<o;r++,t++)s.data[r]=i}return s}}const f="[number]",m="[bound]";class p{constructor(t,e){if(t.hasNaN())throw new Error("NaN detected in matrix! >:(");this.matrix=t,this.words=e}markovChain(){const t=this.matrix.clone(),e=t.rowSums();for(let n=0;n<t.rows;n++)for(let i=0;i<t.cols;i++)t.set(n,i,t.get(n,i)/e[n]);return t}combineWith(...t){return p.combine(this,...t)}makeKey(){return new Map(this.words.map((t,e)=>[t,e]))}wordsByFrequency(t=!1,e=this.makeKey(),n=!0){const i=this.matrix.rowSums(),o=this.words.map((t,e)=>[t,i[e]]);t&&o.sort((t,e)=>e[1]-t[1]);const s=new Map(o);return n&&s.delete(m),s}toFile(){return`${this.words.join("\n")}\n=\n${this.matrix.toFile()}`}static fromFile(t){const[e,n]=t.split("=");return new p(u.fromFile(n),e.split(/\r?\n/).filter(t=>t))}static fromWords(t,e=0){const n=function(t){const e=new Map;for(const n of[].concat(...t)){const t=n.toLowerCase();e.has(t)||e.set(t,new Map);const i=e.get(t);i.set(n,(i.get(n)||0)+1)}for(const[t,n]of e){let i=0,o=t;for(const[t,e]of n)e>i&&(i=e,o=t);e.set(t,o)}return t.map(t=>t.map(t=>e.get(t.toLowerCase())))}(function(t){return t.split(/\. |\?|!|\r?\n/).map(t=>{const e=t.split(/\s+/),n=[];for(let t=0;t<e.length;t++){const o=e[t].split(",");for(let e=0;e<o.length;e++){let s=o[e];if(s){if(0===t&&0===e&&((i=s[0]).toUpperCase()===i&&/[A-Z]/.test(i))&&(s=s.toLowerCase()),/^(?:\d+\.?\d*|\d*\.\d+)$/.test(s)){n.push(f);continue}s=s.replace(/[^a-z']/gi,""),s&&n.push(s)}0!==e&&n.push(",")}}var i;return n}).filter(t=>t.length)}(t)),i=new Map;i.set(m,1/0);for(const t of n)for(const e of t)i.set(e,(i.get(e)||0)+1);const o=[...i.keys()].filter(t=>i.get(t)>=e),s=new u(o.length,o.length),r=o.indexOf(m);for(const t of n){let e=r;for(const n of t){const t=o.indexOf(n);-1!==t&&(s.set(e,t,s.get(e,t)+1),e=t)}s.set(e,r,s.get(e,r)+1)}return new p(s,o)}static combine(...t){const e=[...new Set([].concat(...t.map(({words:t})=>t)))],n=new u(e.length,e.length);return t.forEach(({matrix:t,words:i})=>{const o=new Map(i.map(t=>[t,e.indexOf(t)]));for(let e=0;e<t.rows;e++)for(let s=0;s<t.cols;s++)n.data[o.get(i[e])*n.cols+o.get(i[s])]+=t.data[e*t.cols+s]}),new p(n,e)}}let w,g,v,x=!1;document.addEventListener("keydown",t=>{"Tab"===t.key?(document.body.classList.add("focus-visible"),x=!0):"SPAN"===t.target.tagName&&"Enter"===t.key&&t.target.click()}),document.addEventListener("keyup",t=>{"Tab"===t.key&&(x=!1)}),document.addEventListener("focusin",t=>{x||document.body.classList.remove("focus-visible")});const y=document.getElementById("autocomplete"),b=document.getElementById("input"),_=/(?:(^|\.|!|\?|\n)|(,)|([a-z']+)[ \t]|([0-9\.]+)[ \t])[ \t]*([a-z']*)$/i,C=/[a-z']*$/i,E=/[ \t]*[a-z']*$/i;let S,L=[],k=null,M=[];let T=null;function I(t){if(!y.children.length)return;if(null!==T){y.children[T].classList.remove("selected")}t=(t+y.children.length)%y.children.length,T=t;const e=y.children[T];e.classList.add("selected"),e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():e.scrollIntoView()}function X(){if(null!==T){const t=b.value.slice(0,b.selectionStart),[e]=L[T],n=","===e||e===m?t.match(E):t.match(C);if(!n)return!1;let i;switch(b.selectionStart=n.index,e){case f:i=Math.floor(1e4*Math.random())+" ";break;case",":i=", ";break;case m:i=". ";break;default:i=e+" "}return document.execCommand("insertText",!1,i),!0}return!1}async function Y(t=Promise.resolve()){if(!y.classList.contains("hidden")){const e=window.innerWidth,n=window.innerHeight,o=b.scrollTop,{left:s,top:r}=b.getBoundingClientRect(),{width:l,height:a}=y.getBoundingClientRect(),{top:c,left:d,height:h}=i(b,b.selectionEnd);await t,y.style.left=s+d+l>e?e-l+"px":s+d+"px",r+c-o+h+300>n?r+c-300<0?(y.style.top=r+c-o+h+"px",y.style.maxHeight=n-(r+c+h+300)+"px"):(y.style.top=r+c-o-a+"px",y.style.maxHeight=null):(y.style.top=r+c-o+h+"px",y.style.maxHeight=null)}}function N(){!function(){if(L=[],b.selectionStart!==b.selectionEnd)return;if(!g&&!v)return;const t=b.value.slice(0,b.selectionStart).match(_);if(!t)return;const[,e,n,i,o,s]=t;let r;if(void 0!==e)r=m;else if(void 0!==n)r=",";else if(void 0!==i)r=i.toLowerCase();else{if(void 0===o)return;r=f}if(r!==k){let t;if(i&&w){const e=w.words.find(t=>t.toLowerCase()===r);t=g.get(e)}else t=g.get(r);if(M=[],void 0!==t){k=r;let e=!1;for(let n=0;n<v.cols;n++){const i=w.words[n],o=v.get(t,n);0!==o&&(i===f?e=[f,o]:M.push([k===m?(l=i,l.length?l[0].toUpperCase()+l.slice(1):l):i,o]))}0===M.length&&e?M._number=e:M.sort((t,e)=>e[1]-t[1])}}var l;L=M.filter(([t])=>t.toLowerCase().startsWith(s.toLowerCase())),M._number&&(L._number=M._number)}(),function(){if(L.length){y.classList.remove("hidden");const t=L.slice(0,10),e=JSON.stringify(t);if(S===e)return;S=e,T=null,y.innerHTML="";for(let e=0;e<t.length;e++){const[n,i]=t[e];if(n===f)continue;const o=document.createElement("div");o.className="autocomplete-item",o.dataset.i=e,y.appendChild(o);const s=document.createElement("span");switch(s.className="autocomplete-word",n){case",":s.textContent=",";break;case m:s.textContent=".";break;default:s.textContent=n}o.appendChild(s),o.appendChild(document.createTextNode(" "));const r=document.createElement("span");r.className="autocomplete-frequency",r.textContent=(100*i).toFixed(2)+"%",o.appendChild(r)}}else y.classList.add("hidden"),T=null}(),Y()}b.addEventListener("input",N),b.addEventListener("scroll",Y),document.addEventListener("scroll",Y),document.addEventListener("selectionchange",t=>{document.activeElement===b&&N()}),document.addEventListener("keydown",t=>{if(L.length&&document.activeElement===b){if("ArrowDown"===t.key)I(null===T?0:T+1);else if("ArrowUp"===t.key)I(null===T?-1:T-1);else{if("Tab"!==t.key)return;if(!X())return;document.body.classList.remove("focus-visible")}t.preventDefault()}}),y.addEventListener("click",t=>{const e=t.target.closest(".autocomplete-item");e&&(b.focus(),I(+e.dataset.i),X(),t.preventDefault())});const $=document.getElementById("random");let B=!1,F=null;function q(){if(L&&document.activeElement===b){const t=L.reduce((t,e)=>t+e[1],0);let e=Math.random()*t;for(let t=0;t<L.length;t++)if(e-=L[t][1],e<0){I(t);break}0===L.length&&L._number?(L.unshift(L._number),I(0),X(),L.shift()):X()}B&&(F=setTimeout(q,50))}$.addEventListener("click",t=>{b.focus(),B?(B=!1,null!==F&&(clearTimeout(F),F=null),$.textContent="Generate randomly"):(B=!0,q(),$.textContent="Stop generating")});const W=new class{constructor(){this.canvas=document.createElement("canvas"),this.canvas.className="frequency-renderer",this._context=this.canvas.getContext("2d"),this.scrollX=0,this.scrollY=0,this._width=0,this._height=0,this.canvas.addEventListener("wheel",t=>{this.scrollX+=t.shiftKey?t.deltaY:t.deltaX,this.scrollY+=t.shiftKey?t.deltaX:t.deltaY,this.render()},{passive:!1});let t=null;this.canvas.addEventListener("pointerdown",e=>{null===t&&(t={pointer:e.pointerId,initScrollX:this.scrollX,initScrollY:this.scrollY,initMouseX:e.clientX,initMouseY:e.clientY},this.canvas.setPointerCapture(t.pointer))}),this.canvas.addEventListener("pointermove",e=>{t&&t.pointer===e.pointerId&&(this.scrollX=t.initMouseX-e.clientX+t.initScrollX,this.scrollY=t.initMouseY-e.clientY+t.initScrollY,this.render())});const e=e=>{t&&t.pointer===e.pointerId&&(t=null)};this.canvas.addEventListener("pointerup",e),this.canvas.addEventListener("pointercancel",e)}setFrequencies(t){this.frequencies=t,this._key=t.makeKey(),this._words=[...t.wordsByFrequency(!0,this._key,!1).keys()],this._chain=t.markovChain(),this._context.font='10px "Merriweather", serif';let e=0;for(const t of this._words){const{width:n}=this._context.measureText(t);n>e&&(e=n)}this._maxWidth=e,this.scrollX=this._maxWidth+10-70,this.scrollY=this._maxWidth+10-70}addTo(t){t.appendChild(this.canvas),this.wrapper=t}async resize(t=Promise.resolve()){if(this.wrapper){const{width:e,height:n}=this.wrapper.getBoundingClientRect(),i=window.devicePixelRatio;this._width=e,this._height=n,await t,this.canvas.width=e*i,this.canvas.height=n*i,this._context.scale(i,i),this.render()}}_getFrequency(t,e){return this._chain.get(this._key.get(this._words[t]),this._key.get(this._words[e]))}render(){if(!this.frequencies||!this.wrapper)return;const t=this._context;t.clearRect(0,0,this._width,this._height),t.textBaseline="middle";const e=this._maxWidth+10,n=e+20*this._words.length;this.scrollX<0?this.scrollX=0:this.scrollX>n-this._width&&n>this._width&&(this.scrollX=n-this._width),this.scrollY<0?this.scrollY=0:this.scrollY>n-this._height&&n>this._height&&(this.scrollY=n-this._height);const i=Math.max(Math.floor((this.scrollX-e)/20),0),o=Math.min(Math.ceil((this.scrollX+this._width-e)/20),this._words.length),s=Math.max(Math.floor((this.scrollY-e)/20),0),r=Math.min(Math.ceil((this.scrollY+this._height-e)/20),this._words.length);t.font='10px "Merriweather", serif',t.textAlign="center";for(let n=s;n<r;n++)for(let s=i;s<o;s++){const i=this._getFrequency(n,s);t.fillStyle=`rgba(255, 0, 0, ${i})`,t.fillRect(20*s+e-this.scrollX,20*n+e-this.scrollY,20,20),t.fillStyle=`rgba(255, 255, 255, ${.99*i+.01})`,t.fillText(i.toFixed(3),20*(s+.5)+e-this.scrollX,20*(n+.5)+e-this.scrollY,18)}t.font='10px "Merriweather", serif',t.textAlign="left",t.fillStyle="white";for(let n=s;n<r;n++)t.fillText(this._words[n],5,20*(n+.5)+e-this.scrollY);t.save(),t.rotate(Math.PI/2);for(let n=i;n<o;n++)t.fillText(this._words[n],5,-(20*(n+.5)+e-this.scrollX));t.restore()}};function z(t){w=t,g=t.makeKey(),v=t.markovChain(),W.setFrequencies(t),W.render(),k=null,M=[],N()}function P(t){return fetch(t).then(t=>t.text()).then(p.fromFile).then(z)}W.addTo(document.getElementById("markov-vis")),W.resize();const O=[{url:"./frequencies/peter-piper.txt",name:"Peter Piper"},{url:"./frequencies/winston.txt",name:"Down with Big Brother"},{url:"./frequencies/bee-movie.txt",name:"Bee Movie"},{url:"./frequencies/gatm.txt",name:"A Geometric Approach to Matrices"},{url:"[CUSTOM]",name:"Custom"}],A=document.getElementById("source-wrapper"),j=document.getElementById("source-text"),H=document.getElementById("use-source"),R=document.getElementById("source");for(const{url:t,name:e}of O){const n=document.createElement("option");n.value=t,n.textContent=e,R.appendChild(n)}R.addEventListener("change",t=>{"[CUSTOM]"===R.value?A.classList.remove("hidden"):(P(R.value),A.classList.add("hidden"))}),H.addEventListener("click",t=>{z(p.fromWords(j.value))}),R.value="./frequencies/bee-movie.txt",P("./frequencies/bee-movie.txt"),window.addEventListener("resize",t=>{let e;const n=new Promise(t=>e=t);W.resize(n),Y(n),e()})}]);