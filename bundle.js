!function(t){var e={};function n(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(s,o,function(e){return t[e]}.bind(null,o));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){!function(){var e=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],n="undefined"!=typeof window,s=n&&null!=window.mozInnerScreenX;function o(t,o,i){if(!n)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var r=i&&i.debug||!1;if(r){var l=document.querySelector("#input-textarea-caret-position-mirror-div");l&&l.parentNode.removeChild(l)}var a=document.createElement("div");a.id="input-textarea-caret-position-mirror-div",document.body.appendChild(a);var c=a.style,h=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,d="INPUT"===t.nodeName;c.whiteSpace="pre-wrap",d||(c.wordWrap="break-word"),c.position="absolute",r||(c.visibility="hidden"),e.forEach((function(t){d&&"lineHeight"===t?c.lineHeight=h.height:c[t]=h[t]})),s?t.scrollHeight>parseInt(h.height)&&(c.overflowY="scroll"):c.overflow="hidden",a.textContent=t.value.substring(0,o),d&&(a.textContent=a.textContent.replace(/\s/g," "));var f=document.createElement("span");f.textContent=t.value.substring(o)||".",a.appendChild(f);var u={top:f.offsetTop+parseInt(h.borderTopWidth),left:f.offsetLeft+parseInt(h.borderLeftWidth),height:parseInt(h.lineHeight)};return r?f.style.backgroundColor="#aaa":document.body.removeChild(a),u}void 0!==t.exports?t.exports=o:n&&(window.getCaretCoordinates=o)}()},function(t,e,n){"use strict";n.r(e);var s=n(0);const o="[",i="⎡",r="⎢",l="⎣",a="]",c="⎤",h="⎥",d="⎦";class f{constructor(t,e,n){if(this.rows=t,this.cols=e,this._length=t*e,n&&n.length!==this._length)throw new Error("Given matrix does not match the given dimensions.");this.data=new Float32Array(n||this._length)}scale(t){for(let e=0;e<this._length;e++)this.data[e]*=t;return this}multiply(t){if(this.cols!==t.rows)throw new Error(`Cannot multiply matrices of dimensions ${this.rows} x ${this.cols} and ${t.rows} x ${t.cols}`);const e=this.cols,n=new f(this.rows,t.cols);for(let s=0;s<this.rows;s++)for(let o=0;o<t.cols;o++){const i=s*n.cols+o;for(let r=0;r<e;r++)n.data[i]+=this.data[s*this.cols+r]*t.data[r*t.cols+o]}return n}transpose(){const t=new f(this.cols,this.rows);for(let e=0;e<this.rows;e++)for(let n=0;n<this.cols;n++)t.data[n*t.cols+e]=this.data[e*this.cols+n];return t}rowSums(){const t=new Float32Array(this.rows);for(let e=0;e<this.rows;e++){let n=0;for(let t=0;t<this.cols;t++)n+=this.data[e*this.cols+t];t[e]=n}return t}get(t,e){return this.data[t*this.cols+e]}set(t,e,n){return this.data[t*this.cols+e]=n,this}clone(){return new f(this.rows,this.cols,this.data)}toString(){let t="\n";for(let e=0;e<this.rows;e++)t+=0===e?1===this.rows?o:i:e===this.rows-1?l:r,t+=" "+this.data.slice(e*this.cols,(e+1)*this.cols).join("\t")+" ",t+=0===e?1===this.rows?a:c:e===this.rows-1?d:h,t+="\n";return t}toFile(){let t=`${this.rows}x${this.cols}`,e=null,n=0;for(const s of this.data)s===e?n++:(n>0&&(t+=1===n?`\n${e}`:`\n${e}x${n}`),e=s,n=1);return n>0&&(t+=1===n?`\n${e}`:`\n${e}x${n}`),t}hasNaN(){for(const t of this.data)if(Number.isNaN(t))return!0;return!1}static identity(t){const e=new this(t,t);for(let n=0;n<t;n++)e.data[n*t+n]=1;return e}static fromFile(t){const[e,...n]=t.split(/\r?\n/).filter(t=>t),[,s,o]=e.match(/(\d+)x(\d+)/),i=new f(+s,+o);let r=0;for(const t of n){const[,e,n]=t.match(/(\d+)(?:x(\d+))?/),s=+e,o=n?+n:1;for(let t=0;t<o;r++,t++)i.data[r]=s}return i}}const u="[bound]";class p{constructor(t,e){if(t.hasNaN())throw new Error("NaN detected in matrix! >:(");this.matrix=t,this.words=e}markovChain(){const t=this.matrix.clone(),e=t.rowSums();for(let n=0;n<t.rows;n++)for(let s=0;s<t.cols;s++)t.set(n,s,t.get(n,s)/e[n]);return t}combineWith(...t){return p.combine(this,...t)}makeKey(){return new Map(this.words.map((t,e)=>[t,e]))}wordsByFrequency(t=!1,e=this.makeKey()){const n=this.matrix.rowSums(),s=this.words.map((t,e)=>[t,n[e]]);t&&s.sort((t,e)=>e[1]-t[1]);const o=new Map(s);return o.delete(u),o}toFile(){return`${this.words.join("\n")}\n=\n${this.matrix.toFile()}`}static fromFile(t){const[e,n]=t.split("=");return new p(f.fromFile(n),e.split(/\r?\n/).filter(t=>t))}static fromWords(t,e=0){const n=function(t){const e=new Map;for(const n of[].concat(...t)){const t=n.toLowerCase();e.has(t)||e.set(t,new Map);const s=e.get(t);s.set(n,(s.get(n)||0)+1)}for(const[t,n]of e){let s=0,o=t;for(const[t,e]of n)e>s&&(s=e,o=t);e.set(t,o)}return t.map(t=>t.map(t=>e.get(t.toLowerCase())))}(function(t){return t.split(/\. |\?|!|\r?\n/).map(t=>{const e=t.split(/\s+/),n=[];for(let t=0;t<e.length;t++){const o=e[t].split(",");for(let e=0;e<o.length;e++){let i=o[e];if(i){if(0===t&&0===e&&((s=i[0]).toUpperCase()===s&&/[A-Z]/.test(s))&&(i=i.toLowerCase()),/^(?:\d+\.?\d*|\d*\.\d+)$/.test(i)){n.push("[number]");continue}i=i.replace(/[^a-z']/gi,""),i&&n.push(i)}0!==e&&n.push(",")}}var s;return n}).filter(t=>t.length)}(t)),s=new Map;s.set(u,1/0);for(const t of n)for(const e of t)s.set(e,(s.get(e)||0)+1);const o=[...s.keys()].filter(t=>s.get(t)>=e),i=new f(o.length,o.length),r=o.indexOf(u);for(const t of n){let e=r;for(const n of t){const t=o.indexOf(n);-1!==t&&(i.set(e,t,i.get(e,t)+1),e=t)}i.set(e,r,i.get(e,r)+1)}return new p(i,o)}static combine(...t){const e=[...new Set([].concat(...t.map(({words:t})=>t)))],n=new f(e.length,e.length);return t.forEach(({matrix:t,words:s})=>{const o=new Map(s.map(t=>[t,e.indexOf(t)]));for(let e=0;e<t.rows;e++)for(let i=0;i<t.cols;i++)n.data[o.get(s[e])*n.cols+o.get(s[i])]+=t.data[e*t.cols+i]}),new p(n,e)}}let w,m,g;const v=document.getElementById("autocomplete"),x=document.getElementById("input"),y=/(?:(^|\.|!|\?|\n)|(,)|([a-z']+)[ \t]|([0-9\.]+)[ \t])[ \t]*([a-z']*)$/i,b=/[a-z']*$/i,_=/[ \t]*[a-z']*$/i;let C,S=[],E=null,L=[];let k=null;function M(t){if(!v.children.length)return;if(null!==k){v.children[k].classList.remove("selected")}t=(t+v.children.length)%v.children.length,k=t,v.children[k].classList.add("selected")}function T(){if(null!==k){const t=x.value.slice(0,x.selectionStart),[e]=S[k],n=","===e||e===u?t.match(_):t.match(b);if(!n)return;let s;switch(x.selectionStart=n.index,e){case"[number]":s=Math.floor(1e4*Math.random())+" ";break;case",":s=", ";break;case u:s=". ";break;default:s=e+" "}document.execCommand("insertText",!1,s)}}async function $(t=Promise.resolve()){if(!v.classList.contains("hidden")){const e=window.innerWidth,n=window.innerHeight,o=x.scrollTop,{left:i,top:r}=x.getBoundingClientRect(),{width:l,height:a}=v.getBoundingClientRect(),{top:c,left:h,height:d}=s(x,x.selectionEnd);await t,v.style.left=i+h+l>e?e-l+"px":i+h+"px",r+c-o+d+300>n?r+c-300<0?(v.style.top=r+c-o+d+"px",v.style.maxHeight=n-(r+c+d+300)+"px"):(v.style.top=r+c-o-a+"px",v.style.maxHeight=null):(v.style.top=r+c-o+d+"px",v.style.maxHeight=null)}}function F(){!function(){if(S=[],x.selectionStart!==x.selectionEnd)return;if(!m&&!g)return;const t=x.value.slice(0,x.selectionStart).match(y);if(!t)return;const[,e,n,s,o,i]=t;let r;if(void 0!==e)r=u;else if(void 0!==n)r=",";else if(void 0!==s)r=s.toLowerCase();else{if(void 0===o)return;r="[number]"}if(r!==E){let t;if(s&&w){const e=w.words.find(t=>t.toLowerCase()===r);t=m.get(e)}else t=m.get(r);if(L=[],void 0!==t){E=r;for(let e=0;e<g.cols;e++){const n=g.get(t,e);0!==n&&L.push([E===u?(l=w.words[e],l.length?l[0].toUpperCase()+l.slice(1):l):w.words[e],n])}L.sort((t,e)=>e[1]-t[1])}}var l;S=L.filter(([t])=>t.toLowerCase().startsWith(i.toLowerCase()))}(),function(){if(S.length){v.classList.remove("hidden");const t=S.slice(0,5),e=JSON.stringify(t);if(C===e)return;C=e,k=null,v.innerHTML="";for(let e=0;e<t.length;e++){const[n,s]=t[e];if("[number]"===n)continue;const o=document.createElement("div");o.className="autocomplete-item",o.dataset.i=e,v.appendChild(o);const i=document.createElement("span");switch(i.className="autocomplete-word",n){case",":i.textContent=",";break;case u:i.textContent=".";break;default:i.textContent=n}o.appendChild(i),o.appendChild(document.createTextNode(" "));const r=document.createElement("span");r.className="autocomplete-frequency",r.textContent=(100*s).toFixed(2)+"%",o.appendChild(r)}}else v.classList.add("hidden"),k=null}(),$()}x.addEventListener("input",F),x.addEventListener("scroll",$),document.addEventListener("selectionchange",t=>{document.activeElement===x&&F()}),document.addEventListener("keydown",t=>{if(S.length){if("ArrowDown"===t.key)M(null===k?0:k+1);else if("ArrowUp"===t.key)M(null===k?-1:k-1);else{if("Tab"!==t.key)return;T()}t.preventDefault()}}),v.addEventListener("click",t=>{const e=t.target.closest(".autocomplete-item");e&&(x.focus(),M(+e.dataset.i),T(),t.preventDefault())});const N=new class{constructor(){this.canvas=document.createElement("canvas"),this.canvas.className="frequency-renderer",this._context=this.canvas.getContext("2d"),this.scrollX=0,this.scrollY=0,this._width=0,this._height=0,this.canvas.addEventListener("wheel",t=>{this.scrollX+=t.shiftKey?t.deltaY:t.deltaX,this.scrollY+=t.shiftKey?t.deltaX:t.deltaY,this.render()},{passive:!1});let t=null;this.canvas.addEventListener("pointerdown",e=>{null===t&&(t=e.pointerId,this.canvas.setPointerCapture(t))}),this.canvas.addEventListener("pointermove",e=>{t===e.pointerId&&(this.scrollX-=e.movementX,this.scrollY-=e.movementY,this.render())});const e=e=>{t===e.pointerId&&(t=null)};this.canvas.addEventListener("pointerup",e),this.canvas.addEventListener("pointercancel",e)}setFrequencies(t){this.frequencies=t,this._key=t.makeKey(),this._words=[...t.wordsByFrequency(!0,this._key).keys()],this._chain=t.markovChain(),this._context.font='10px "Merriweather", serif';let e=0;for(const t of this._words){const{width:n}=this._context.measureText(t);n>e&&(e=n)}this._maxWidth=e}addTo(t){t.appendChild(this.canvas),this.wrapper=t}async resize(t=Promise.resolve()){if(this.wrapper){const{width:e,height:n}=this.wrapper.getBoundingClientRect(),s=window.devicePixelRatio;this._width=e,this._height=n,await t,this.canvas.width=e*s,this.canvas.height=n*s,this._context.scale(s,s),this.render()}}_getFrequency(t,e){return this._chain.get(this._key.get(this._words[t]),this._key.get(this._words[e]))}render(){if(!this.frequencies||!this.wrapper)return;const t=this._context;t.clearRect(0,0,this._width,this._height),t.textBaseline="middle";const e=this._maxWidth+10,n=e+20*this._words.length;this.scrollX<0?this.scrollX=0:this.scrollX>n-this._width&&(this.scrollX=n-this._width),this.scrollY<0?this.scrollY=0:this.scrollY>n-this._height&&(this.scrollY=n-this._height);const s=Math.max(Math.floor((this.scrollX-e)/20),0),o=Math.min(Math.ceil((this.scrollX+this._width-e)/20),this._words.length),i=Math.max(Math.floor((this.scrollY-e)/20),0),r=Math.min(Math.ceil((this.scrollY+this._height-e)/20),this._words.length);t.font='10px "Merriweather", serif',t.textAlign="center";for(let n=i;n<r;n++)for(let i=s;i<o;i++){const s=this._getFrequency(n,i);t.fillStyle=`rgba(255, 0, 0, ${s})`,t.fillRect(20*i+e-this.scrollX,20*n+e-this.scrollY,20,20),t.fillStyle=`rgba(255, 255, 255, ${.99*s+.01})`,t.fillText(s.toFixed(3),20*(i+.5)+e-this.scrollX,20*(n+.5)+e-this.scrollY,18)}t.font='10px "Merriweather", serif',t.textAlign="left",t.fillStyle="white";for(let n=i;n<r;n++)t.fillText(this._words[n],5,20*(n+.5)+e-this.scrollY);t.save(),t.rotate(Math.PI/2);for(let n=s;n<o;n++)t.fillText(this._words[n],5,-(20*(n+.5)+e-this.scrollX));t.restore()}};N.addTo(document.getElementById("markov-vis")),N.resize(),fetch("./frequencies/bee-movie.txt").then(t=>t.text()).then(p.fromFile).then(t=>{w=t,m=t.makeKey(),g=t.markovChain(),N.setFrequencies(t),N.render(),F()}),window.addEventListener("resize",t=>{let e;const n=new Promise(t=>e=t);N.resize(n),$(n),e()})}]);